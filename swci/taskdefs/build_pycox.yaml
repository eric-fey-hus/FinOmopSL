######################################################################
# (C)Copyright 2021-2023 Hewlett Packard Enterprise Development LP
######################################################################
Name: build_pycox
TaskType: MAKE_USER_CONTAINER
Author: HPESwarm
Prereq: ROOTTASK
Outcome: user-image-pycox
Body:
    BuildContext: sl-cli-lib
    BuildType: INLINE
    BuildSteps:
    - FROM python:3.9.17 
    - ' '
    - SHELL ["/bin/bash", "-c"]
    - RUN wget https://repo.anaconda.com/miniconda/Miniconda3-py39_23.3.1-0-Linux-x86_64.sh -nv
    - RUN sh Miniconda3-py39_23.3.1-0-Linux-x86_64.sh -b -p /usr/local/miniconda 
    - ENV PATH="/usr/local/miniconda/bin:$PATH"
    - ' '
    - RUN conda install pip pytorch torchvision torchaudio pytorch-cuda=11.7 -c pytorch -c nvidia -y
    - ' '
    - RUN apt-get update && apt-get install           \
    - '   build-essential python3-dev python3-pip     \'
    - '   python3-setuptools --no-install-recommends -y'
    - ' '
    - RUN pip3 install --upgrade pip protobuf && pip3 install \
    - '   matplotlib opencv-python pandas '
    - ' '
    - RUN mkdir -p /tmp/hpe-swarmcli-pkg
    - COPY swarmlearning-client-py3-none-manylinux_2_24_x86_64.whl /tmp/hpe-swarmcli-pkg/swarmlearning-client-py3-none-manylinux_2_24_x86_64.whl
    - RUN pip3 install /tmp/hpe-swarmcli-pkg/swarmlearning-client-py3-none-manylinux_2_24_x86_64.whl
    - ' '
    - RUN pip install pycox 
    - RUN pip install sklearn-pandas
    - RUN echo "from pycox.models import DeepHitSingle" | python3 
